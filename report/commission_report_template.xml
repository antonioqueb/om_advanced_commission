<odoo>
    <!-- 1. Definición de la Acción de Reporte -->
    <record id="action_report_commission_pdf" model="ir.actions.report">
        <field name="name">Reporte Detallado de Comisiones</field>
        <field name="model">commission.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">om_advanced_commission.report_commission_document</field>
        <field name="report_file">om_advanced_commission.report_commission_document</field>
        <field name="print_report_name">'Comisiones %s - %s' % (object.date_from, object.date_to)</field>
        <field name="binding_model_id" ref="model_commission_report_wizard"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="base.paperformat_euro"/> 
    </record>

    <!-- 2. Plantilla QWeb Estilizada -->
    <template id="report_commission_document">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page" style="font-family: 'Helvetica', Arial, sans-serif; font-size: 11px; color: #333;">
                    
                    <!-- ENCABEZADO MODERNO -->
                    <div class="row mb-5">
                        <div class="col-12 text-center">
                            <h2 style="font-weight: 900; text-transform: uppercase; letter-spacing: 1px; color: #000; margin-bottom: 5px;">
                                Reporte de Comisiones
                            </h2>
                            <div style="border-bottom: 3px solid #000; width: 60px; margin: 0 auto 15px auto;"></div>
                            <p style="font-size: 13px; color: #666;">
                                <strong>Periodo:</strong> 
                                <span t-esc="data['date_from']" t-options='{"widget": "date"}' class="ml-1 mr-1"/>
                                <i class="fa fa-long-arrow-right mx-1"/>
                                <span t-esc="data['date_to']" t-options='{"widget": "date"}' class="ml-1"/>
                            </p>
                        </div>
                    </div>

                    <!-- Iterar sobre cada Vendedor -->
                    <t t-foreach="docs" t-as="group">
                        
                        <!-- SEPARADOR DE VENDEDOR -->
                        <div class="mt-4 mb-3" style="border-left: 6px solid #000; padding-left: 10px; background-color: #f8f9fa; padding-top:8px; padding-bottom:8px;">
                            <span style="font-size: 15px; font-weight: bold; color: #212529; text-transform: uppercase;">
                                <i class="fa fa-user-circle-o mr-2" style="opacity: 0.6;"></i>
                                <span t-field="group['partner'].name"/>
                            </span>
                        </div>

                        <!-- TABLA MODERNA -->
                        <table class="table table-sm table-borderless" style="margin-bottom: 30px;">
                            <!-- 
                                CABECERA NEGRA, TEXTO BLANCO 
                                Nota: Usamos !important en el color para sobreescribir estilos de Bootstrap en PDF 
                            -->
                            <thead style="background-color: #000000; color: #FFFFFF;">
                                <tr style="border-bottom: 2px solid #000;">
                                    <th class="text-center align-middle" style="width: 9%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">FOLIO</th>
                                    <th class="text-center align-middle" style="width: 9%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">FECHA FAC.</th>
                                    <th class="align-middle" style="width: 16%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">CLIENTE</th>
                                    <th class="align-middle" style="width: 13%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">PROYECTO</th>
                                    <th class="text-center align-middle" style="width: 9%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">F. PAGO</th>
                                    <th class="text-center align-middle" style="width: 9%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">FACTURA</th>
                                    <th class="text-right align-middle" style="width: 12%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">BASE ($)</th>
                                    <th class="text-center align-middle" style="width: 8%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">%</th>
                                    <th class="text-right align-middle" style="width: 15%; padding: 8px; font-weight: 600; color: #FFFFFF !important;">COMISIÓN ($)</th>
                                </tr>
                            </thead>
                            
                            <!-- CUERPO -->
                            <tbody>
                                <tr t-foreach="group['moves']" t-as="move" style="border-bottom: 1px solid #e9ecef;">
                                    <td class="text-center align-middle py-2">
                                        <span t-field="move.sale_order_id.name" style="font-weight: 500;"/>
                                    </td>
                                    <td class="text-center align-middle text-muted">
                                        <span t-if="move.invoice_line_id" t-field="move.invoice_line_id.move_id.invoice_date"/>
                                        <span t-else="">-</span>
                                    </td>
                                    <td class="align-middle">
                                        <span t-field="move.sale_order_id.partner_id.name" 
                                              style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 160px; font-weight: 500;"/>
                                    </td>
                                    <td class="align-middle text-muted">
                                        <span t-if="move.sale_order_id.x_project_id" t-field="move.sale_order_id.x_project_id.name"/>
                                        <span t-else="">-</span>
                                    </td>
                                    <td class="text-center align-middle">
                                        <span t-if="move.payment_id" t-field="move.payment_id.date"/>
                                        <span t-else="" t-field="move.date"/>
                                    </td>
                                    <td class="text-center align-middle">
                                        <span class="badge badge-light border" style="font-size: 10px;">
                                            <t t-if="move.invoice_line_id">
                                                <span t-field="move.invoice_line_id.move_id.name"/>
                                            </t>
                                            <t t-else="">Varios</t>
                                        </span>
                                    </td>
                                    <td class="text-right align-middle">
                                        <span t-field="move.base_amount_paid" 
                                              t-options='{"widget": "monetary", "display_currency": move.currency_id}'/>
                                    </td>
                                    <!-- Porcentaje limpio (sin fondo) -->
                                    <td class="text-center align-middle">
                                        <t t-if="move.base_amount_paid and move.base_amount_paid != 0">
                                            <span t-esc="abs(round((move.amount / move.base_amount_paid) * 100, 2))" style="font-weight: bold;"/>%
                                        </t>
                                        <t t-else="">Fijo</t>
                                    </td>
                                    <td class="text-right align-middle" style="font-weight: bold; color: #000;">
                                        <span t-field="move.amount" 
                                              t-options='{"widget": "monetary", "display_currency": move.currency_id}'/>
                                    </td>
                                </tr>
                            </tbody>

                            <!-- PIE DE TOTALES -->
                            <tfoot>
                                <tr style="background-color: #f0f0f0;">
                                    <td colspan="6" class="text-right align-middle text-uppercase" style="padding: 10px; font-weight: bold; color: #555;">
                                        Totales <span t-field="group['partner'].name"/>:
                                    </td>
                                    <td class="text-right align-middle" style="padding: 10px; font-weight: bold;">
                                        <span t-esc="group['total_base']" 
                                              t-options='{"widget": "monetary", "display_currency": group["partner"].currency_id}'/>
                                    </td>
                                    <td class="align-middle"></td>
                                    <td class="text-right align-middle" style="padding: 10px; background-color: #1a1a1a; color: #fff; font-size: 12px; font-weight: bold;">
                                        <span t-esc="group['total_commission']" 
                                              t-options='{"widget": "monetary", "display_currency": group["partner"].currency_id}'/>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </t>

                    <div t-if="not docs" class="alert alert-secondary mt-5 text-center p-5 shadow-sm">
                        <h4 class="alert-heading">Sin Información</h4>
                        <p>No se encontraron comisiones aprobadas o pendientes para este rango de fechas.</p>
                    </div>

                    <!-- NOTA LEGAL / DISCLAIMER -->
                    <div class="row" style="margin-top: 50px; page-break-inside: avoid;">
                        <div class="col-12">
                            <div style="border-top: 1px solid #ccc; padding-top: 10px; font-size: 9px; color: #666; text-align: justify;">
                                <strong>IMPORTANTE:</strong> Las comisiones detalladas en el presente reporte han sido calculadas sobre la base de los pagos efectivamente recibidos.
                                Se hace constar que aquellas comisiones previamente liquidadas que sean objeto de <strong>devoluciones, cancelaciones o notas de crédito</strong> posteriores
                                por parte del cliente, resultarán en un ajuste negativo (deducción) automático en el siguiente periodo de cálculo y liquidación de comisiones del agente correspondiente.
                            </div>
                        </div>
                    </div>

                </div>
            </t>
        </t>
    </template>
</odoo>